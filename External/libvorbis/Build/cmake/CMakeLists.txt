PROJECT(libvorbis C)

CMAKE_MINIMUM_REQUIRED(VERSION 2.8.6)

SET(VORBIS_MAJOR_VERSION 1)
SET(VORBIS_MINOR_VERSION 3)
SET(VORBIS_PATCH_VERSION 6)
SET(VORBIS_VERSION ${VORBIS_MAJOR_VERSION}.${VORBIS_MINOR_VERSION}.${VORBIS_PATCH_VERSION})

SET(VORBIS_PROJECT_DIR "${CMAKE_CURRENT_SOURCE_DIR}/../..")
SET(KLAYGE_ROOT_DIR "${VORBIS_PROJECT_DIR}/../../")

INCLUDE(${KLAYGE_ROOT_DIR}/cmake/Common.cmake)
INCLUDE(${KLAYGE_ROOT_DIR}/cmake/Platform.cmake)
INCLUDE(${KLAYGE_ROOT_DIR}/cmake/Compiler.cmake)
INCLUDE(${KLAYGE_ROOT_DIR}/External/Build/CMake/ExternalCommon.cmake)

SET_PROPERTY(GLOBAL PROPERTY USE_FOLDERS ON)

SET(VORBIS_OUTPUT_DIR "${VORBIS_PROJECT_DIR}/libs/${KLAYGE_PLATFORM_NAME}")
SET(REL_PATH "External/Downloads/libvorbis-${VORBIS_VERSION}.patched.7z")
SET(SEVENZIP_PATH "${KLAYGE_ROOT_DIR}/External/Downloads/${KLAYGE_HOST_PLATFORM_NAME}/7z")
SET(PACKAGE_FILE_ID "7756763f2bda2d9af764b9bf8fe000239e762791")

DOWNLOAD_PACKAGE("libvorbis" ${REL_PATH} ${PACKAGE_FILE_ID} "README.md")

FOREACH(flag_var
		CMAKE_C_FLAGS CMAKE_CXX_FLAGS)
	IF(KLAYGE_COMPILER_MSVC)
		STRING(REPLACE "/W4" "/W0" ${flag_var} "${${flag_var}}")
		STRING(REPLACE "/WX" "/WX-" ${flag_var} "${${flag_var}}")
	ELSE()
		STRING(REPLACE "-Wall" "-w" ${flag_var} "${${flag_var}}")
		STRING(REPLACE "-Werror" "-Wno-error" ${flag_var} "${${flag_var}}")
	ENDIF()
ENDFOREACH()

SET(BUILD_SHARED_LIBS OFF)
SET(BUILD_FRAMEWORK OFF)
SET(OGG_ROOT ${VORBIS_PROJECT_DIR}/../libogg)
FIND_LIBRARY(OGG_LIBRARIES NAMES ogg_static${KLAYGE_OUTPUT_SUFFIX} HINTS ${OGG_ROOT}/lib/${KLAYGE_PLATFORM_NAME})
INCLUDE_DIRECTORIES(${OGG_ROOT}/Build/${KLAYGE_BUILD_FOLDER}/ogg/include)
IF(KLAYGE_PLATFORM_WINDOWS_STORE)
	ADD_DEFINITIONS(-D_CRT_SECURE_NO_WARNINGS)
ENDIF()

ADD_SUBDIRECTORY(${VORBIS_PROJECT_DIR} "${CMAKE_CURRENT_BINARY_DIR}/vorbis")

SET_TARGET_PROPERTIES(vorbis PROPERTIES
	ARCHIVE_OUTPUT_DIRECTORY ${VORBIS_OUTPUT_DIR}
	ARCHIVE_OUTPUT_DIRECTORY_DEBUG ${VORBIS_OUTPUT_DIR}
	ARCHIVE_OUTPUT_DIRECTORY_RELEASE ${VORBIS_OUTPUT_DIR}
	ARCHIVE_OUTPUT_DIRECTORY_RELWITHDEBINFO ${VORBIS_OUTPUT_DIR}
	ARCHIVE_OUTPUT_DIRECTORY_MINSIZEREL ${VORBIS_OUTPUT_DIR}
	PROJECT_LABEL vorbis
	DEBUG_POSTFIX ${CMAKE_DEBUG_POSTFIX}
	OUTPUT_NAME vorbis_static${KLAYGE_OUTPUT_SUFFIX}
)
SET_TARGET_PROPERTIES(vorbisfile PROPERTIES
	ARCHIVE_OUTPUT_DIRECTORY ${VORBIS_OUTPUT_DIR}
	ARCHIVE_OUTPUT_DIRECTORY_DEBUG ${VORBIS_OUTPUT_DIR}
	ARCHIVE_OUTPUT_DIRECTORY_RELEASE ${VORBIS_OUTPUT_DIR}
	ARCHIVE_OUTPUT_DIRECTORY_RELWITHDEBINFO ${VORBIS_OUTPUT_DIR}
	ARCHIVE_OUTPUT_DIRECTORY_MINSIZEREL ${VORBIS_OUTPUT_DIR}
	PROJECT_LABEL vorbisfile
	DEBUG_POSTFIX ${CMAKE_DEBUG_POSTFIX}
	OUTPUT_NAME vorbisfile_static${KLAYGE_OUTPUT_SUFFIX}
)
