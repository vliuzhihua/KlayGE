FUNCTION(DOWNLOAD_7Z)
	IF(KLAYGE_HOST_PLATFORM_WINDOWS)
		SET(SEVENZIP_EXE_FILE_ID "20fea1314dbed552d5fedee096e2050369172ee1")
		SET(SEVENZIP_DLL_FILE_ID "344faf61c3eb76f4a2fb6452e83ed16c9cce73e0")
		DOWNLOAD_DEPENDENCY("External/Downloads/${KLAYGE_HOST_PLATFORM_NAME}/7z.exe" ${SEVENZIP_EXE_FILE_ID})
		DOWNLOAD_DEPENDENCY("External/Downloads/${KLAYGE_HOST_PLATFORM_NAME}/7z.dll" ${SEVENZIP_DLL_FILE_ID})
	ELSE()
		IF(KLAYGE_HOST_PLATFORM_LINUX)
			SET(SEVENZIP_EXE_FILE_ID "5692603bb94cff211178544738d5446bcdc2f438")
			SET(SEVENZIP_DLL_FILE_ID "e54e3a090dbc9bcaeda02688ee5a7d124df9dbba")
		ELSE()
			SET(SEVENZIP_EXE_FILE_ID "4faf36abd7797d8fa16d72ff499689c6f68a589e")
			SET(SEVENZIP_DLL_FILE_ID "c11f9e7a0f3c7abf70bc86cbff724b7a5d464911")
		ENDIF()
		DOWNLOAD_DEPENDENCY("External/Downloads/${KLAYGE_HOST_PLATFORM_NAME}/7z" ${SEVENZIP_EXE_FILE_ID})
		DOWNLOAD_DEPENDENCY("External/Downloads/${KLAYGE_HOST_PLATFORM_NAME}/7z.so" ${SEVENZIP_DLL_FILE_ID})
		FILE(COPY "${KLAYGE_ROOT_DIR}/External/Downloads/${KLAYGE_HOST_PLATFORM_NAME}/7z" DESTINATION "${KLAYGE_ROOT_DIR}/External/Downloads")
		FILE(COPY "${KLAYGE_ROOT_DIR}/External/Downloads/7z" DESTINATION "${KLAYGE_ROOT_DIR}/External/Downloads/${KLAYGE_HOST_PLATFORM_NAME}/" FILE_PERMISSIONS OWNER_READ OWNER_WRITE OWNER_EXECUTE)
	ENDIF()
ENDFUNCTION()

FUNCTION(DOWNLOAD_PACKAGE PACKAGE_NAME RELATIVE_PATH FILE_ID CHECK_FILE)
	DOWNLOAD_7Z()
	DOWNLOAD_DEPENDENCY(${RELATIVE_PATH} ${FILE_ID} FILE_CHANGED)

	IF(FILE_CHANGED OR (NOT EXISTS "${KLAYGE_ROOT_DIR}/External/${PACKAGE_NAME}/${CHECK_FILE}"))
		EXECUTE_PROCESS(COMMAND "${SEVENZIP_PATH}" "x" "-y" "${KLAYGE_ROOT_DIR}/${RELATIVE_PATH}" WORKING_DIRECTORY "${KLAYGE_ROOT_DIR}/External/${PACKAGE_NAME}")
	ENDIF()
ENDFUNCTION()
